#!/usr/bin/env python3
# -*- encoding: utf-8 -*-

from fsdm import ResourceHandler, CoapError, DataType, KvStore
from kubernetes import client, config

class ResourceHandler_33626_4(ResourceHandler):
    NAME = "Memory usage"
    DESCRIPTION = '''\
Node's memory usage.'''
    DATATYPE = DataType.FLOAT
    EXTERNAL_NOTIFY = False

    def read(self,
             instance_id,            # int
             resource_instance_id):  # int for multiple resources, None otherwise
        config.load_kube_config()
        v1 = client.CoreV1Api()
        node = v1.list_node(watch=False).items[instance_id]
        allocatable = node.status.allocatable
        capacity = node.status.capacity
        print(int(capacity['memory'].split('Ki')[0]) - int(allocatable['memory'].split('Ki')[0]))




if __name__ == '__main__':
    ResourceHandler_33626_4().main()
